leaving:
  alias: Leaving the house
  sequence:
  - service: script.turn_off_indoor_lights
  - service: script.turn_off_switches_and_store_states
  mode: single
  icon: mdi:home-export-outline  
turn_off_indoor_lights:
  alias: Turn Off Indoor Lights
  sequence:
  - service: light.turn_off
    data: {}
    entity_id:
    - light.zolder_group
    - light.gelijkvloers_group
    - light.eerste_verdiep_group
turn_off_switches_and_store_states:
  alias: Store devices state
  sequence:
  - service: scene.create
    data:
      scene_id: stored_states
      snapshot_entities:
      - switch.boiler_keuken
  - service: switch.turn_off
    data: {}
    entity_id: switch.boiler_keuken
  - service: media_player.turn_off
    entity_id: 
      - media_player.samsung_samsung_dtv_rcr
      - media_player.huis
arriving:
  alias: Arriving at our house
  sequence:
    - service: script.turn_on_switches_and_stored_states
    - service: script.deactivate_guest_mode
    - service: script.set_thermostat_home
  mode: single
  icon: mdi:home-import-outline 
turn_on_switches_and_stored_states:
  alias: Turn On Switches and Restore Devices State
  sequence:
  - service: scene.turn_on
    data:
      entity_id: scene.stored_states
  - service: switch.turn_on
    data: {}
    entity_id: switch.boiler_keuken

set_temperature:
  alias: Set Temperature
  sequence:
  - service: climate.set_operation_mode
    data:
      entity_id: climate.downstairs
      operation_mode: heat
  - service: climate.set_temperature
    data_template:
      temperature: '{{ states.sensor.temperature_degrees.state | float }}'
  - service: notify.hazilverberkenstraatbot
    data_template:
      message: Temperature set to {{ states.sensor.temperature_degrees.state}}
  - service: input_boolean.turn_off
    data:
      entity_id: input_boolean.tempsetactive

set_thermostat_away:
  sequence:
  - data:
      preset_mode: away
      entity_id: climate.downstairs
    service: climate.set_preset_mode

set_thermostat_home:
  sequence:
  - data:
      present_mode: none
      entity_id: climate.downstairs
    service: climate.set_present_mode

start_up_home_assistant:
  alias: Start Up Home Assistant
  sequence: []

ask_to_active_guest_mode:
  alias: Ask to active guest mode
  sequence:
    - service: telegram_bot.send_message
      data_template:
        target: '[ 689595780, 696299625 ]'
        title: Guest Mode Activation
        message: Wil je Guest Mode activeren? 
        inline_keyboard:
        - Ja graag.:/yesguest
        - Nee dank u.:/noguest

activate_guest_mode:
  sequence:
  - service: input_boolean.turn_on
    data:
      entity_id: input_boolean.guest_mode
  - service: script.set_thermostat_home
  - service: notify.hazilverberkenstraatbot
    data_template:
      message: 'Guest mode activated'
deactivate_guest_mode:
  sequence:
  - condition: state
    entity_id:
      - binary_sensor.guest_mode
    state: 'on'
  - service: input_boolean.turn_off
    data:
      entity_id: input_boolean.guest_mode
  - service: notify.hazilverberkenstraatbot
    data_template:
      message: 'Guest mode deactivated'
notify_afval:
  alias: Notify Afval
  sequence:
  - service: notify.hazilverberkenstraatbot
    data_template:
      message: '{{ states(''sensor.recycleapp_morgen'') }} morgen buiten zetten!'

motion_detected:
  alias: Motion Detected
  mode: parallel
  fields:
    sensor:
      description: How detected the motion
      example: camera garage
  sequence:
  - service: camera.snapshot
    data_template:
      entity_id: camera.oprit
      filename: /config/www/snapshots/camera.oprit.jpg
  - service: notify.hazilverberkenstraatbot
    data_template:
      message: Buiten beweging gedetecteerd, {{ sensor }}
      data:
        photo:
        - file: /config/www/snapshots/camera.oprit.jpg
          caption: Beweging gedecteerd door {{ sensor }}
  - service: script.ask_to_active_guest_mode

vacuum:
  alias: Vacuum
  mode: single
  sequence:
  - condition: and
    conditions:
    - condition: state
      entity_id:
      - input_boolean.daily_vacuum_first_run
      - input_boolean.disable_daily_vacuum
      state: 'off'
    - condition: time
      after: 07:00:00
      before: '19:00:00'
  - variables:
      start_time: '{{ as_timestamp(now()) }}'
  - service: vacuum.start
    entity_id: vacuum.xiaomi_vacuum_cleaner
  - service: input_number.increment
    entity_id: input_number.vacuum_number_of_runs
  - service: input_boolean.turn_on
    entity_id: input_boolean.daily_vacuum_first_run
  - condition: state
    entity_id:
    - input_boolean.disable_dustbin_notification
    state: 'off'
  - wait_for_trigger:
      platform: template
      value_template: '{{ is_state(vacuum.xiaomi_vacuum_cleaner, ''docked'') }}'
    timeout: 02:00:00
    continue_on_timeout: false
  - variables:
      end_time: '{{ as_timestamp(now()) }}'
  - variables:
      total_time: '{{ (end_time|float - start_time|float) }}'
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ states(''input_number.vacuum_number_of_runs'') | int >=
          states(''input_number.vacuum_empty_bin_after_days'') | int }}'
      sequence:
      - service: telegram_bot.send_message
        data_template:
          target: '[ 689595780, 696299625 ]'
          title: Stofzuiger
          message: Stofzuiger is klaar na {{ total_time }} minuten. Het is tijd dat
            de vuilbak van stofzuiger wordt geleegd!
          inline_keyboard:
          - Gedaan.:/vacuumemptybindone
          - Uitstel.:/vacuumemptybinextend
    default:
    - service: notify.hazilverberkenstraatbot
      data_template:
        message: Stofzuiger is klaar na {{ total_time }} minuten
  icon: mdi:robot-vacuum
vacuum_zone:
  alias: Vacuum a Specific Zone
  mode: single
  fields:
    zone:
      description: zone
      example: keuken
  sequence:
  - variables:
      start_time: '{{ as_timestamp(now()) }}'
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ zone == ''Keuken'' }}'
      sequence:
      - service: vacuum.send_command
        data:
          entity_id: vacuum.xiaomi_vacuum_cleaner
          command: app_zoned_clean
          params:
          - 23386
          - 23366
          - 25286
          - 28216
          - 1
    - conditions:
      - condition: template
        value_template: '{{ zone == ''Eet Kamer'' }}'
      sequence:
      - service: vacuum.send_command
        data:
          entity_id: vacuum.xiaomi_vacuum_cleaner
          command: app_zoned_clean
          params:
          - 25244
          - 21493
          - 30594
          - 26593
          - 1
    - conditions:
      - condition: template
        value_template: '{{ zone == ''Livng'' }}'
      sequence:
      - service: vacuum.send_command
        data:
          entity_id: vacuum.xiaomi_vacuum_cleaner
          command: app_zoned_clean
          params:
          - 24260
          - 16982
          - 30710
          - 21882
          - 1
    - conditions:
      - condition: template
        value_template: '{{ zone == ''Inkom'' }}'
      sequence:
      - service: vacuum.send_command
        data:
          entity_id: vacuum.xiaomi_vacuum_cleaner
          command: app_zoned_clean
          params:
          - 23110
          - 14614
          - 25410
          - 18664
          - 1
    - conditions:
      - condition: template
        value_template: '{{ zone == ''Berging'' }}'
      sequence:
      - service: vacuum.send_command
        data:
          entity_id: vacuum.xiaomi_vacuum_cleaner
          command: app_zoned_clean
          params:
          - 23508
          - 21814
          - 25408
          - 23314
          - 1
  - wait_for_trigger:
      platform: template
      value_template: '{{ is_state(''vacuum.xiaomi_vacuum_cleaner'', ''docked'') }}'
    timeout: 02:00:00
    continue_on_timeout: false
  - service: input_select.select_option
    entity_id: input_select.vacuum_room
    data:
      option: Selecteer Kamer
  - condition: state
    entity_id:
    - input_boolean.disable_dustbin_notification
    state: 'off'
  - variables:
      end_time: '{{ as_timestamp(now()) }}'
  - variables:
      total_time: '{{ (end_time|float - start_time|float) }}'
  - service: notify.hazilverberkenstraatbot
    data_template:
      message: Stofzuiger is klaar met {{zone}} in {{ total_time }} minuten.
  icon: mdi:robot-vacuum
vacuum_bin_feedback:
  icon: mdi:robot-vacuum
  alias: Vacuum bin feedback
  fields:
    command:
      description: the response command from telegram
      example: vacuumemptybindone
    callback_id:
      description: the callback_id to give a reponse
      example: ''
  sequence:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ command == ''vacuumemptybindone'' }}'
      sequence:
      - service: input_number.set_value
        data:
          entity_id: input_number.vacuum_number_of_runs
          value: 0
  - service: telegram_bot.answer_callback_query
    data_template:
      callback_query_id: '{{ callback_id }}'
      message: >
        {% if (command == 'vacuumemptybindone') %}
        Genoteerd dat de vuilbak is geleegd!
        {% elif (command == 'vacuumemptybinextend') %}
        Uitgesteld tot de volgende run!
        {% endif %}
  mode: single
low_battery_notification:
  sequence:
  - service: persistent_notification.create
    data_template:
      title: Low Battery Device
      message: '{{name}} has only {{battery}}% left!'
      notification_id: lowbatterydevice{{entity_id}}
dismiss_low_battery_notification:
  sequence:
  - service: persistent_notification.dismiss
    data_template:
      notification_id: lowbatterydevice{{entity_id}}
wakeup_light_sunrise:
  alias: Wakeup Light Sunrise
  sequence:
  - data_template:
      brightness: 1
      white_value: 0
      entity_id: '{{entity_id}}'
      xy_color:
      - 0.67
      - 0.39
    service: light.turn_on
  - delay:
      seconds: 1
  - data_template:
      brightness: 85
      transition: 12
      white_value: 0
      entity_id: '{{entity_id}}'
      xy_color:
      - 0.65
      - 0.41
    service: light.turn_on
  - delay:
      seconds: 15
  - data_template:
      brightness: 170
      transition: 12
      white_value: 0
      entity_id: '{{entity_id}}'
      xy_color:
      - 0.6
      - 0.4
    service: light.turn_on
  - delay:
      seconds: 15
  - data_template:
      brightness: 255
      transition: 12
      white_value: 0
      entity_id: '{{entity_id}}'
      xy_color:
      - 0.48
      - 0.4
    service: light.turn_on
  - delay:
      seconds: 15
  - data_template:
      brightness: 255
      color_name: white
      transition: 12
      white_value: 255
      entity_id: '{{entity_id}}'
    service: light.turn_on
  - delay:
      seconds: 15
ui_tts:
  sequence:
  - service: script.turn_on
    entity_id: script.play_tts
    data_template:
      variables:
        message: '{{states.input_text.tts.state}}'
snapshot_spotify:
  sequence:
  - service: variable.set_variable
    data:
      variable: spotify_phdelodder
      value_template: "{% if is_state('media_player.spotify_phdelodder', 'playing')\
        \ and (\n   is_state_attr('media_player.spotify_phdelodder', 'source', 'Huis')\
        \ or\n   is_state_attr('media_player.spotify_phdelodder', 'source', 'Tablet')\
        \ or\n   is_state_attr('media_player.spotify_phdelodder', 'source', 'Bureau')\
        \ or\n   is_state_attr('media_player.spotify_phdelodder', 'source', 'Woonkamer'))\
        \ %}\nTrue {% else %} False {% endif %}\n"
  - service: variable.set_variable
    data:
      variable: spotify_febe
      value_template: "{% if is_state('media_player.spotify_febe', 'playing') and\
        \ (\n   is_state_attr('media_player.spotify_febe', 'source', 'Huis') or\n\
        \   is_state_attr('media_player.spotify_febe', 'source', 'Tablet') or\n  \
        \ is_state_attr('media_player.spotify_febe', 'source', 'Bureau') or\n   is_state_attr('media_player.spotify_febe',\
        \ 'source', 'Woonkamer')) %}\nTrue {% else %} False {% endif %}\n"
  - service: variable.set_variable
    data:
      variable: spotify_margot
      value_template: "{% if is_state('media_player.spotify_margot', 'playing') and\
        \ (\n   is_state_attr('media_player.spotify_margot', 'source', 'Huis') or\n\
        \   is_state_attr('media_player.spotify_margot', 'source', 'Tablet') or\n\
        \   is_state_attr('media_player.spotify_margot', 'source', 'Bureau') or\n\
        \   is_state_attr('media_player.spotify_margot', 'source', 'Woonkamer')) %}\n\
        True {% else %} False {% endif %}\n"
  - service: variable.set_variable
    data:
      variable: spotify_isabel
      value_template: "{% if is_state('media_player.spotify_isabel', 'playing') and\
        \ (\n   is_state_attr('media_player.spotify_isabel', 'source', 'Huis') or\n\
        \   is_state_attr('media_player.spotify_isabel', 'source', 'Tablet') or\n\
        \   is_state_attr('media_player.spotify_isabel', 'source', 'Bureau') or\n\
        \   is_state_attr('media_player.spotify_isabel', 'source', 'Woonkamer')) %}\n\
        True {% else %} False {% endif %}\n"
  - condition: template
    value_template: "{{ is_state('variable.spotify_isabel', \"True\") \n   or is_state('variable.spotify_febe',\
      \ \"True\") \n   or is_state('variable.spotify_margot', \"True\") \n   or is_state('variable.spotify_phdelodder',\
      \ \"True\") }}"
  - service: media_player.media_pause
    data_template:
      entity_id: "{% if is_state('variable.spotify_isabel', \"True\") %}\n media_player.spotify_isabel\n\
        {% endif %} {% if is_state('variable.spotify_febe', \"True\") %}\n media_player.spotify_febe\n\
        {% endif %} {% if is_state('variable.spotify_margot', \"True\") %}\n media_player.spotify_margot\n\
        {% endif %} {% if is_state('variable.spotify_phdelodder', \"True\") %}\n media_player.spotify_phdelodder\n\
        {% endif %}"
restore_spotify_user:
  sequence:
  - condition: template
    value_template: '{{ is_state( var , "True") }}'
  - service: media_player.media_play
    data_template:
      entity_id: '{{ media_player }}'
  - service: variable.set_variable
    data_template:
      variable: '{{ var_short }}'
      value: false
restore_spotify:
  sequence:
  - condition: template
    value_template: "{{ is_state('variable.spotify_isabel', \"True\") or\n   is_state('variable.spotify_febe',\
      \ \"True\") or\n   is_state('variable.spotify_margot', \"True\") or\n   is_state('variable.spotify_phdelodder',\
      \ \"True\") }}"
  - service: script.turn_on
    entity_id: script.restore_spotify_user
    data:
      variables:
        media_player: media_player.spotify_isabel
        var: variable.spotify_isabel
        var_short: spotify_isabel
  - service: script.turn_on
    entity_id: script.restore_spotify_user
    data:
      variables:
        media_player: media_player.spotify_febe
        var: variable.spotify_febe
        var_short: spotify_febe
  - service: script.turn_on
    entity_id: script.restore_spotify_user
    data:
      variables:
        media_player: media_player.spotify_margot
        var: variable.spotify_margot
        var_short: spotify_margot
  - service: script.turn_on
    entity_id: script.restore_spotify_user
    data:
      variables:
        media_player: media_player.spotify_phdelodder
        var: variable.spotify_phdelodder
        var_short: spotify_phdelodder
snapshot_mopidy:
  sequence:
  - service: variable.set_variable
    data:
      variable: mpd_huis
      value_template: "{% if is_state('media_player.huis', 'playing') %}\n  True\n\
        {% else %}\n  False\n{% endif%}\n"
  - service: variable.set_variable
    data:
      variable: mpd_huis_stream
      value_template: "{% if is_state('media_player.huis', 'playing') %}\n  {{ states.media_player.huis.attributes.media_content_id\
        \ }}\n{% else %}\n   \n{% endif%}\n"
restore_mopidy:
  sequence:
  - condition: template
    value_template: '{{ is_state(''variable.mpd_huis'', "True") }}'
  - data_template:
      entity_id: media_player.huis
      media_content_id: '{{ states(''variable.mpd_huis_stream'') }}

        '
      media_content_type: music
    service: media_player.play_media
  - service: variable.set_variable
    data:
      variable: mpd_huis
      value: false
play_tts:
  sequence:
  - service: snapcast.snapshot
    data:
      entity_id:
      - media_player.snapcast_client_hentho
      - media_player.snapcast_client_xgin
      - media_player.snapcast_client_tablet
  - service: script.turn_on
    entity_id: script.snapshot_spotify
  - service: script.turn_on
    entity_id: script.snapshot_mopidy
  - service: media_player.media_pause
    entity_id: media_player.huis
  - service: media_player.select_source
    data:
      entity_id:
      - media_player.snapcast_client_hentho
      - media_player.snapcast_client_xgin
      - media_player.snapcast_client_tablet
      source: Mopidy
  - service: media_player.volume_set
    data:
      entity_id:
      - media_player.snapcast_client_hentho
      - media_player.snapcast_client_xgin
      - media_player.snapcast_client_tablet
      volume_level: 1.0
  - service: media_player.volume_mute
    data:
      entity_id:
      - media_player.snapcast_client_hentho
      - media_player.snapcast_client_xgin
      - media_player.snapcast_client_tablet
      is_volume_muted: false
  - service: media_player.play_media
    data:
      entity_id: media_player.huis
      media_content_id: https://ha.delodder.be/local/hail.mp3
      media_content_type: music
  - wait_template: '{{states.media_player.huis.state == ''off''}}'
    timeout: 120
  - delay: 00:00:01
  - service: tts.google_translate_say
    data_template:
      entity_id: media_player.huis
      message: '{{message}}'
  - wait_template: '{{states.media_player.huis.state == ''off''}}'
    timeout: 120
  - delay: 00:00:04
  - service: media_player.media_pause
    data_template:
      entity_id: media_player.huis
  - service: snapcast.restore
    data:
      entity_id:
      - media_player.snapcast_client_hentho
      - media_player.snapcast_client_xgin
      - media_player.snapcast_client_tablet
  - service: script.turn_on
    entity_id: script.restore_spotify
  - service: script.turn_on
    entity_id: script.restore_mopidy
play_tts_nodered:
  sequence: []
play_studiobrussel_home:
  sequence:
  - service: variable.set_variable
    data:
      variable: radio_playing
      value: StuBru
  - data_template:
      entity_id: media_player.huis
      media_content_id: "{% if states('input_select.stu_bru_streams') == 'Bruut' %}\n\
        \  http://icecast.vrtcdn.be/stubru_bruut.aac\n{% elif states('input_select.stu_bru_streams')\
        \ == 'Hooray' %}\n  http://icecast.vrtcdn.be/stubru_hiphophooray.aac\n{% elif\
        \ states('input_select.stu_bru_streams') == 'De Tijdloze' %}\n  http://icecast.vrtcdn.be/stubru_tijdloze.aac\n\
        {% elif states('input_select.stu_bru_streams') == '#ikluisterbelgisch' %}\n\
        \  http://icecast.vrtcdn.be/stubru_tgs.aac\n{% elif states('input_select.stu_bru_streams')\
        \ == 'Live Radio' %}\n  http://icecast.vrtcdn.be/stubru.aac\n{% endif %}"
      media_content_type: music
    service: media_player.play_media
sunrise_wled:
  alias: Sunrise wled
  sequence:
  - service: wled.effect
    data:
      entity_id: '{{ wled_id }}'
      effect: solid
  - service: wled.effect
    data_template:
      entity_id: '{{ wled_id }}'
      effect: sunrise
      speed: '{{ time | int }}'
      intensity: 255
  - service: light.turn_on
    data_template:
      entity_id: '{{ wled_id }}'
  - delay: '{{ time | multiply(60) | int }}'
  mode: parallel
  icon: mdi:weather-sunset-up
  max: 4
