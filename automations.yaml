- id: Start_Up_Home_Assistant
  alias: Start Up Home Assistant
  trigger:
  - platform: homeassistant
    event: start
  action:
  - service: script.turn_on
    entity_id: script.start_up_home_assistant
- id: shellies_announce
  alias: Shellies Announce
  trigger:
  - platform: homeassistant
    event: start
  action:
    service: mqtt.publish
    data:
      topic: shellies/command
      payload: announce
- id: shellies_discovery
  alias: Shellies Discovery
  trigger:
  - platform: mqtt
    topic: shellies/announce
  action:
    service: python_script.shellies_discovery
    data_template:
      id: '{{ trigger.payload_json.id }}'
      mac: '{{ trigger.payload_json.mac }}'
      fw_ver: '{{ trigger.payload_json.fw_ver }}'
      shelly1-2C6E97-relay-0: light
- alias: Update Last Motion
  id: Update Last Motion
  initial_state: 'on'
  trigger:
  - platform: state
    entity_id:
    - binary_sensor.bureau_motion
    - binary_sensor.speelkamer_motion
    - binary_sensor.motion_achterdeur
    - binary_sensor.oprit_camera
    - binary_sensor.voor_deur
    - binary_sensor.achter_deur
    - binary_sensor.keuken_deur
    - binary_sensor.garage_deur
    - binary_sensor.motion_wc_boven
    - binary_sensor.motion_wc_beneden
    - binary_sensor.motion_gang_eerste_2
    - binary_sensor.motion_gang_eerste_1
    - binary_sensor.motion_inkom
    - binary_sensor.motion_gang_zolder
    - binary_sensor.motion_voordeur
    - binary_sensor.motion_bureau
    - binary_sensor.motion_logeerkamer
    - binary_sensor.motion_speelkamer
    - binary_sensor.motion_living
    to: 'on'
  action:
    service: variable.set_variable
    data:
      variable: last_motion
      attributes_template: "{\n      \"history_1\": \"{{ variable.state }}\",\n  \
        \    \"history_2\": \"{{ variable.attributes.history_1 }}\",\n      \"history_3\"\
        : \"{{ variable.attributes.history_2 }}\",\n      \"history_4\": \"{{ variable.attributes.history_3\
        \ }}\",\n      \"history_5\": \"{{ variable.attributes.history_4 }}\",\n \
        \     \"history_6\": \"{{ variable.attributes.history_5 }}\",\n      \"history_7\"\
        : \"{{ variable.attributes.history_6 }}\",\n      \"history_8\": \"{{ variable.attributes.history_7\
        \ }}\",\n      \"history_9\": \"{{ variable.attributes.history_8 }}\",\n \
        \     \"history_10\": \"{{ variable.attributes.history_9 }}\"\n}\n"
    data_template:
      value: '{{ trigger.to_state.attributes.friendly_name|replace(''motion sensor'','''')
        }}: {{as_timestamp(states.variable.last_motion.last_changed)| timestamp_custom(''%X'')
        }}

        '
- id: '1575277594428'
  alias: Set night profile for oprit camera
  description: ''
  trigger:
  - event: sunset
    platform: sun
  condition: []
  action:
  - service: shell_command.set_oprit_profile_night
- id: '1575277627609'
  alias: Set day profile for oprit camera
  description: ''
  trigger:
  - event: sunrise
    platform: sun
  condition: []
  action:
  - service: shell_command.set_oprit_profile_day
- id: '1578590308661'
  alias: NachtTafel Licht Febe Aan
  description: ''
  trigger:
  - device_id: aecf8a3bd0144f6f9fbbedf7e7c503dc
    domain: deconz
    platform: device
    subtype: turn_on
    type: remote_button_short_press
  condition:
  - condition: device
    device_id: 9d61839836424735bb9de4c9ad91230a
    domain: light
    entity_id: light.nachttafel_febe
    type: is_off
  action:
  - entity_id: scene.default_nachttafel_febe
    service: scene.turn_on
- id: NachtTafel Licht Febe Uit
  alias: NachtTafel Licht Febe Uit
  description: ''
  trigger:
  - device_id: aecf8a3bd0144f6f9fbbedf7e7c503dc
    domain: deconz
    platform: device
    subtype: turn_on
    type: remote_button_short_press
  condition:
  - condition: device
    device_id: 9d61839836424735bb9de4c9ad91230a
    domain: light
    entity_id: light.nachttafel_febe
    type: is_on
  action:
  - entity_id: light.nachttafel_febe
    service: light.turn_off
- id: '1578590350074'
  alias: NachtTafel Licht Margot Aan
  description: ''
  trigger:
  - device_id: ed641ace598140ab84eff39005e4e6d0
    domain: deconz
    platform: device
    subtype: turn_on
    type: remote_button_short_press
  condition:
  - condition: device
    device_id: 5a5791e30bae435f93fc82b4bbb5dfb8
    domain: light
    entity_id: light.nachttafel_margot
    type: is_off
  action:
  - entity_id: scene.default_nachttafel_margot
    service: scene.turn_on
- id: '1586931483975'
  alias: Send Notification Afval Collection
  description: ''
  trigger:
  - at: '18:00'
    platform: time
  condition:
    condition: or
    conditions:
    - condition: state
      entity_id: sensor.ophaalkalender_morgen
      state: papier, pmd
    - condition: state
      entity_id: sensor.ophaalkalender_morgen
      state: restafval
    - condition: state
      entity_id: sensor.ophaalkalender_morgen
      state: groenafval
  action:
  - data: {}
    service: script.notify_afval
- id: '1586960390567'
  alias: Moestuin Low on Water
  description: ''
  trigger:
  - below: '25'
    entity_id: sensor.moestuin_moisture
    platform: numeric_state
  condition: []
  action:
  - data:
      data_template:
        message: Moestuin heeft vochtigheid van {{ states('sensor.moestuin_moisture')
          }}, dringend water geven!
    service: notify.hazilverberkenstraatbot
- id: '1586960390568'
  alias: Rozemarijn Low on Water
  description: ''
  trigger:
  - below: '25'
    entity_id: sensor.rozemarijn_moisture
    platform: numeric_state
  condition: []
  action:
  - data:
      data_template:
        message: Rozemarijn heeft vochtigheid van {{ states('sensor.rozemarijn_moisture')
          }}, dringend water geven!
    service: notify.hazilverberkenstraatbot
- id: '1587360682923'
  alias: Alarm Clock Philippe
  description: https://flemmingss.com/wake-up-light-based-on-android-alarm-with-home-assistant-and-tasker/
  trigger:
  - platform: template
    value_template: '{% set alarm_time = as_timestamp(states(''input_datetime.philippe_phone_next_alarm''))
      %}

      {% set time_now = as_timestamp(states(''sensor.date_time'').replace('','',''''))
      %}

      {{ time_now >= ( alarm_time - 300) }}'
  condition:
  - condition: state
    entity_id: input_boolean.philippe_phone_alarm_set
    state: 'on'
  - condition: state
    entity_id: person.philippe
    state: home
  action:
  - service: script.turn_on
    entity_id: script.wakeup_light_sunrise
    data:
      variables:
        entity_id: light.led_slaapkamer
- id: Sync Tasmota states
  alias: Sync Tasmota states
  initial_state: true
  trigger:
    platform: homeassistant
    event: start
  action:
  - service: mqtt.publish
    data:
      topic: cmnd/tasmotas/state
      payload: ''
  - service: mqtt.publish
    data:
      topic: tasmotas/cmnd/state
      payload: ''
- id: '1587624008968'
  alias: Switch Febe Shaken
  description: ''
  trigger:
  - device_id: aecf8a3bd0144f6f9fbbedf7e7c503dc
    domain: deconz
    platform: device
    subtype: ''
    type: remote_gyro_activated
  condition: []
  action:
  - data_template:
      effect: '{{ state_attr("light.nachttafel_febe", "effect_list") | random }}'
      rgb_color:
      - '{{ (range(0, 255)|random) }}'
      - '{{ (range(0, 255)|random) }}'
      - '{{ (range(0, 255)|random) }}'
      transition: '{{ (range(1, 3)|random) }}'
      entity_id: light.nachttafel_febe
    entity_id: light.nachttafel_febe
    service: light.turn_on
- id: '1587626119060'
  alias: NachtTafel Licht Margot Uit
  description: ''
  trigger:
  - device_id: ed641ace598140ab84eff39005e4e6d0
    domain: deconz
    platform: device
    subtype: turn_on
    type: remote_button_short_press
  condition:
  - condition: device
    device_id: 5a5791e30bae435f93fc82b4bbb5dfb8
    domain: light
    entity_id: light.nachttafel_margot
    type: is_on
  action:
  - data: {}
    entity_id: light.nachttafel_margot
    service: light.turn_off
- id: '1587626206992'
  alias: Switch Margot Shaken
  description: ''
  trigger:
  - device_id: ed641ace598140ab84eff39005e4e6d0
    domain: deconz
    platform: device
    subtype: ''
    type: remote_gyro_activated
  condition: []
  action:
  - data_template:
      effect: '{{ state_attr("light.nachttafel_margot", "effect_list") | random }}'
      rgb_color:
      - '{{ (range(0, 255)|random) }}'
      - '{{ (range(0, 255)|random) }}'
      - '{{ (range(0, 255)|random) }}'
      transition: '{{ (range(1, 3)|random) }}'
    entity_id: light.nachttafel_margot
    service: light.turn_on
- id: Alarm Clock Febe
  alias: Alarm Clock Febe
  trigger:
  - platform: template
    value_template: "{{ states('sensor.time') == \n    (state_attr('input_datetime.febe_next_alarm',\
      \ 'timestamp') - 300)\n         |timestamp_custom('%H:%M', false) }}"
  condition:
  - condition: state
    entity_id: input_boolean.febe_alarm_set
    state: 'on'
  action:
  - service: script.turn_on
    entity_id: script.wakeup_febe_sunrise
    data:
      variables:
        entity_id: light.nachttafel_febe
- id: Alarm Clock Margot
  alias: Alarm Clock Margot
  trigger:
  - platform: template
    value_template: "{{ states('sensor.time') == \n    (state_attr('input_datetime.margot_next_alarm',\
      \ 'timestamp') - 300)\n         |timestamp_custom('%H:%M', false) }}"
  condition:
  - condition: state
    entity_id: input_boolean.margot_alarm_set
    state: 'on'
  action:
  - data:
      variables:
        entity_id: light.nachttafel_margot
    entity_id: script.wakeup_margot_sunrise
    service: script.turn_on
