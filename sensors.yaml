- platform: template
  sensors:
    temperature_degrees:
      friendly_name: 'Temperature'
      value_template: '{{states("input_number.temperature") | float(0)}}'

- platform: time_date
  display_options:
    - 'time'
    - 'date'
    - 'date_time'
    - 'time_utc'

- platform: template
  sensors:

    # Zone Times - templated on history_stats sensors
    zone1_time_today:
      friendly_name: Zone 1 total watering time today
      value_template: >
        {{ states('sensor.greenhouse_valve_1_history_today') | float(0) * 60 | round }}
      unit_of_measurement: minutes
      icon_template: mdi:water

    zone2_time_today:
      friendly_name: Zone 2 total watering time today
      value_template: >
        {{ states('sensor.greenhouse_valve_2_history_today') | float(0) * 60 | round }}
      unit_of_measurement: minutes
      icon_template: mdi:water
        
    zone3_time_today:
      friendly_name: Zone 3 total watering time today
      value_template: >
        {{ states('sensor.greenhouse_valve_3_history_today') | float(0) * 60 | round }}
      unit_of_measurement: minutes
      icon_template: mdi:water
        
    zone4_time_today:
      friendly_name: Zone 4 total watering time today
      value_template: >
        {{ states('sensor.greenhouse_valve_4_history_today') | float(0) * 60 | round }}
      unit_of_measurement: minutes
      icon_template: mdi:water

# History sensors
# Zone Times
- platform: history_stats
  name: greenhouse_valve_1_history_today
  entity_id: switch.greenhouse_valve_1
  state: 'on'
  type: time
  start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
  end: '{{ now() }}'
- platform: history_stats
  name: greenhouse_valve_1_history_yesterday
  entity_id: switch.greenhouse_valve_1
  state: 'on'
  type: time
  end: '{{ now().replace(hour=0, minute=0, second=0) }}'
  duration:
    hours: 24
- platform: history_stats
  name: greenhouse_valve_1_history_week
  entity_id: switch.greenhouse_valve_1
  state: 'on'
  type: time
  end: '{{ now().replace(hour=0, minute=0, second=0) }}'
  duration:
    days: 7
- platform: history_stats
  name: greenhouse_valve_1_history_month
  entity_id: switch.greenhouse_valve_1
  state: 'on'
  type: time
  end: '{{ now().replace(hour=0, minute=0, second=0) }}'
  duration:
    days: 30
- platform: history_stats
  name: greenhouse_valve_1_history_year
  entity_id: switch.greenhouse_valve_1
  state: 'on'
  type: time
  start: '{{ now().replace(month=1).replace(day=1).replace(hour=0).replace(minute=0).replace(second=0) }}'
  end: '{{ now() }}'
- platform: history_stats
  name: greenhouse_valve_1_history_alltime
  entity_id: switch.greenhouse_valve_1
  state: 'on'
  type: time
  start: '{{ 0 }}'
  end: '{{ now() }}'
- platform: template
  sensors:
    greenhouse_valve_1_stats:
      icon_template: >-
        {% if is_state('switch.greenhouse_valve_1', 'on') %}
          mdi:chart-line-stacked
        {% else %}
          mdi:chart-line
        {% endif %}
      value_template: >-
        {{ state_attr('sensor.greenhouse_valve_1_history_today', 'value') }}
      attribute_templates:
        today: >-
          {{ state_attr('sensor.greenhouse_valve_1_history_today', 'value') }}
        yesterday: >-
          {{ state_attr('sensor.greenhouse_valve_1_history_yesterday', 'value') }}
        week: >-
          {{ state_attr('sensor.greenhouse_valve_1_history_week', 'value') }}
        month: >-
          {{ state_attr('sensor.greenhouse_valve_1_history_month', 'value') }}
        year: >-
          {{ states('sensor.greenhouse_valve_1_history_year') + state_attr('sensor.greenhouse_valve_1_history_year', 'unit_of_measurement') }}
        all: >-
          {{ states('sensor.greenhouse_valve_1_history_alltime') + state_attr('sensor.greenhouse_valve_1_history_year', 'unit_of_measurement') }}

- platform: history_stats
  name: greenhouse_valve_2_history_today
  entity_id: switch.greenhouse_valve_2
  state: 'on'
  type: time
  start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
  end: '{{ now() }}'
- platform: history_stats
  name: greenhouse_valve_2_history_yesterday
  entity_id: switch.greenhouse_valve_2
  state: 'on'
  type: time
  end: '{{ now().replace(hour=0, minute=0, second=0) }}'
  duration:
    hours: 24
- platform: history_stats
  name: greenhouse_valve_2_history_week
  entity_id: switch.greenhouse_valve_2
  state: 'on'
  type: time
  end: '{{ now().replace(hour=0, minute=0, second=0) }}'
  duration:
    days: 7
- platform: history_stats
  name: greenhouse_valve_2_history_month
  entity_id: switch.greenhouse_valve_2
  state: 'on'
  type: time
  end: '{{ now().replace(hour=0, minute=0, second=0) }}'
  duration:
    days: 30
- platform: history_stats
  name: greenhouse_valve_2_history_year
  entity_id: switch.greenhouse_valve_2
  state: 'on'
  type: time
  start: '{{ now().replace(month=1).replace(day=1).replace(hour=0).replace(minute=0).replace(second=0) }}'
  end: '{{ now() }}'
- platform: history_stats
  name: greenhouse_valve_2_history_alltime
  entity_id: switch.greenhouse_valve_2
  state: 'on'
  type: time
  start: '{{ 0 }}'
  end: '{{ now() }}'
- platform: template
  sensors:
    greenhouse_valve_2_stats:
      icon_template: >-
        {% if is_state('switch.greenhouse_valve_2', 'on') %}
          mdi:chart-line-stacked
        {% else %}
          mdi:chart-line
        {% endif %}
      value_template: >-
        {{ state_attr('sensor.greenhouse_valve_2_history_today', 'value') }}
      attribute_templates:
        today: >-
          {{ state_attr('sensor.greenhouse_valve_2_history_today', 'value') }}
        yesterday: >-
          {{ state_attr('sensor.greenhouse_valve_2_history_yesterday', 'value') }}
        week: >-
          {{ state_attr('sensor.greenhouse_valve_2_history_week', 'value') }}
        month: >-
          {{ state_attr('sensor.greenhouse_valve_2_history_month', 'value') }}
        year: >-
          {{ states('sensor.greenhouse_valve_2_history_year') + state_attr('sensor.greenhouse_valve_2_history_year', 'unit_of_measurement') }}
        all: >-
          {{ states('sensor.greenhouse_valve_2_history_alltime') + state_attr('sensor.greenhouse_valve_2_history_year', 'unit_of_measurement') }}

- platform: history_stats
  name: greenhouse_valve_3_history_today
  entity_id: switch.greenhouse_valve_3
  state: 'on'
  type: time
  start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
  end: '{{ now() }}'
- platform: history_stats
  name: greenhouse_valve_3_history_yesterday
  entity_id: switch.greenhouse_valve_3
  state: 'on'
  type: time
  end: '{{ now().replace(hour=0, minute=0, second=0) }}'
  duration:
    hours: 24
- platform: history_stats
  name: greenhouse_valve_3_history_week
  entity_id: switch.greenhouse_valve_3
  state: 'on'
  type: time
  end: '{{ now().replace(hour=0, minute=0, second=0) }}'
  duration:
    days: 7
- platform: history_stats
  name: greenhouse_valve_3_history_month
  entity_id: switch.greenhouse_valve_3
  state: 'on'
  type: time
  end: '{{ now().replace(hour=0, minute=0, second=0) }}'
  duration:
    days: 30
- platform: history_stats
  name: greenhouse_valve_3_history_year
  entity_id: switch.greenhouse_valve_3
  state: 'on'
  type: time
  start: '{{ now().replace(month=1).replace(day=1).replace(hour=0).replace(minute=0).replace(second=0) }}'
  end: '{{ now() }}'
- platform: history_stats
  name: greenhouse_valve_3_history_alltime
  entity_id: switch.greenhouse_valve_3
  state: 'on'
  type: time
  start: '{{ 0 }}'
  end: '{{ now() }}'
- platform: template
  sensors:
    greenhouse_valve_3_stats:
      icon_template: >-
        {% if is_state('switch.greenhouse_valve_3', 'on') %}
          mdi:chart-line-stacked
        {% else %}
          mdi:chart-line
        {% endif %}
      value_template: >-
        {{ state_attr('sensor.greenhouse_valve_3_history_today', 'value') }}
      attribute_templates:
        today: >-
          {{ state_attr('sensor.greenhouse_valve_3_history_today', 'value') }}
        yesterday: >-
          {{ state_attr('sensor.greenhouse_valve_3_history_yesterday', 'value') }}
        week: >-
          {{ state_attr('sensor.greenhouse_valve_3_history_week', 'value') }}
        month: >-
          {{ state_attr('sensor.greenhouse_valve_3_history_month', 'value') }}
        year: >-
          {{ states('sensor.greenhouse_valve_3_history_year') + state_attr('sensor.greenhouse_valve_3_history_year', 'unit_of_measurement') }}
        all: >-
          {{ states('sensor.greenhouse_valve_3_history_alltime') + state_attr('sensor.greenhouse_valve_3_history_year', 'unit_of_measurement') }}

- platform: history_stats
  name: greenhouse_valve_4_history_today
  entity_id: switch.greenhouse_valve_4
  state: 'on'
  type: time
  start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
  end: '{{ now() }}'
- platform: history_stats
  name: greenhouse_valve_4_history_yesterday
  entity_id: switch.greenhouse_valve_4
  state: 'on'
  type: time
  end: '{{ now().replace(hour=0, minute=0, second=0) }}'
  duration:
    hours: 24
- platform: history_stats
  name: greenhouse_valve_4_history_week
  entity_id: switch.greenhouse_valve_4
  state: 'on'
  type: time
  end: '{{ now().replace(hour=0, minute=0, second=0) }}'
  duration:
    days: 7
- platform: history_stats
  name: greenhouse_valve_4_history_month
  entity_id: switch.greenhouse_valve_4
  state: 'on'
  type: time
  end: '{{ now().replace(hour=0, minute=0, second=0) }}'
  duration:
    days: 30
- platform: history_stats
  name: greenhouse_valve_4_history_year
  entity_id: switch.greenhouse_valve_4
  state: 'on'
  type: time
  start: '{{ now().replace(month=1).replace(day=1).replace(hour=0).replace(minute=0).replace(second=0) }}'
  end: '{{ now() }}'
- platform: history_stats
  name: greenhouse_valve_4_history_alltime
  entity_id: switch.greenhouse_valve_4
  state: 'on'
  type: time
  start: '{{ 0 }}'
  end: '{{ now() }}'
- platform: template
  sensors:
    greenhouse_valve_4_stats:
      icon_template: >-
        {% if is_state('switch.greenhouse_valve_4', 'on') %}
          mdi:chart-line-stacked
        {% else %}
          mdi:chart-line
        {% endif %}
      value_template: >-
        {{ state_attr('sensor.greenhouse_valve_4_history_today', 'value') }}
      attribute_templates:
        today: >-
          {{ state_attr('sensor.greenhouse_valve_4_history_today', 'value') }}
        yesterday: >-
          {{ state_attr('sensor.greenhouse_valve_4_history_yesterday', 'value') }}
        week: >-
          {{ state_attr('sensor.greenhouse_valve_4_history_week', 'value') }}
        month: >-
          {{ state_attr('sensor.greenhouse_valve_4_history_month', 'value') }}
        year: >-
          {{ states('sensor.greenhouse_valve_4_history_year') + state_attr('sensor.greenhouse_valve_4_history_year', 'unit_of_measurement') }}
        all: >-
          {{ states('sensor.greenhouse_valve_4_history_alltime') + state_attr('sensor.greenhouse_valve_4_history_year', 'unit_of_measurement') }}
- platform: history_stats
  name: greenhouse_valve_5_history_today
  entity_id: switch.greenhouse_valve_5
  state: 'on'
  type: time
  start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
  end: '{{ now() }}'
- platform: history_stats
  name: greenhouse_valve_5_history_yesterday
  entity_id: switch.greenhouse_valve_5
  state: 'on'
  type: time
  end: '{{ now().replace(hour=0, minute=0, second=0) }}'
  duration:
    hours: 25
- platform: history_stats
  name: greenhouse_valve_5_history_week
  entity_id: switch.greenhouse_valve_5
  state: 'on'
  type: time
  end: '{{ now().replace(hour=0, minute=0, second=0) }}'
  duration:
    days: 7
- platform: history_stats
  name: greenhouse_valve_5_history_month
  entity_id: switch.greenhouse_valve_5
  state: 'on'
  type: time
  end: '{{ now().replace(hour=0, minute=0, second=0) }}'
  duration:
    days: 30
- platform: history_stats
  name: greenhouse_valve_5_history_year
  entity_id: switch.greenhouse_valve_5
  state: 'on'
  type: time
  start: '{{ now().replace(month=1).replace(day=1).replace(hour=0).replace(minute=0).replace(second=0) }}'
  end: '{{ now() }}'
- platform: history_stats
  name: greenhouse_valve_5_history_alltime
  entity_id: switch.greenhouse_valve_5
  state: 'on'
  type: time
  start: '{{ 0 }}'
  end: '{{ now() }}'
- platform: template
  sensors:
    greenhouse_valve_5_stats:
      icon_template: >-
        {% if is_state('switch.greenhouse_valve_5', 'on') %}
          mdi:chart-line-stacked
        {% else %}
          mdi:chart-line
        {% endif %}
      value_template: >-
        {{ state_attr('sensor.greenhouse_valve_5_history_today', 'value') }}
      attribute_templates:
        today: >-
          {{ state_attr('sensor.greenhouse_valve_5_history_today', 'value') }}
        yesterday: >-
          {{ state_attr('sensor.greenhouse_valve_5_history_yesterday', 'value') }}
        week: >-
          {{ state_attr('sensor.greenhouse_valve_5_history_week', 'value') }}
        month: >-
          {{ state_attr('sensor.greenhouse_valve_5_history_month', 'value') }}
        year: >-
          {{ states('sensor.greenhouse_valve_5_history_year') + state_attr('sensor.greenhouse_valve_5_history_year', 'unit_of_measurement') }}
        all: >-
          {{ states('sensor.greenhouse_valve_5_history_alltime') + state_attr('sensor.greenhouse_valve_5_history_year', 'unit_of_measurement') }}

- platform: template
  sensors:
    vacuum_status:
      friendly_name: Status
      value_template: 'Status: {{ states.vacuum.dalek.attributes.status }}'
      icon_template: >
        {% set val =  states.vacuum.dalek.attributes.status  %}
        {% if val == 'Charging' %}
          mdi:battery-charging
        {% elif val == 'Cleaning' %}
          mdi:move-resize
        {% elif val == 'Returning home' %}
          mdi:keyboard-return
        {% elif val == 'Idle' %}
          mdi:dots-horizontal
        {% elif val == 'Paused' %}
          mdi:pause-circle
        {% else %}
          mdi:help-circle
        {% endif %}
    vacuum_fan_speed:
      value_template: 'Mode: {{ states.vacuum.dalek.attributes.fan_speed }}'
      icon_template: 'mdi:speedometer'
    vacuum_battery:
      friendly_name: Vacuum Battery
      value_template: 'Battery: {{ states.vacuum.dalek.attributes.battery_level }}'
      unit_of_measurement: '%'
      icon_template: '{{ states.vacuum.dalek.attributes.battery_icon }}'
    vacuum_cleaning_time:
      friendly_name: Time of Last Cycle
      value_template: >-
        {% set s = states('sensor.dalek_last_clean_duration')|int(0) %}
        {{ '%02d:%02d' % ((s/3600)|int(0), (s%3600)/60) }}
      icon_template: 'mdi:timer'
    vacuum_cleaned_area:
      friendly_name: Area of Last Cycle
      unit_of_measurement: 'm ²'
      value_template: '{{ states.vacuum.dalek.attributes.cleaned_area }}'
      icon_template: 'mdi:ruler'
    vacuum_cleanmainbrush:
      friendly_name: Replace main brush
      unit_of_measurement: 'h'
      value_template: >-
        Main Brush: 
        {% set s = states('sensor.dalek_main_brush_left')|int(0) %}
        {{ '%02d:%02d' % ((s/3600)|int(0), (s%3600)/60) }}
      icon_template: 'mdi:screwdriver'
    vacuum_cleansidebrush:
      friendly_name: Replace side brush
      unit_of_measurement: 'h'
      value_template: >-
        Side Brush: 
        {% set s = states('sensor.dalek_side_brush_left')|int(0) %}
        {{ '%02d:%02d' % ((s/3600)|int(0), (s%3600)/60) }}
      icon_template: 'mdi:screwdriver'
    vacuum_cleanfilter:
      friendly_name: Replace filter
      unit_of_measurement: 'h'
      value_template: >-
        Filter: 
        {% set s = states('sensor.dalek_filter_left')|int(0) %}
        {{ '%02d:%02d' % ((s/3600)|int(0), (s%3600)/60) }}
      icon_template: 'mdi:screwdriver'
    vacuum_sensordirtyleft:
      friendly_name: Replace filter
      unit_of_measurement: 'h'
      value_template: >-
        Filter: 
        {% set s = states('sensor.dalek_sensor_dirty_left')|int(0) %}
        {{ '%02d:%02d' % ((s/3600)|int(0), (s%3600)/60) }}
      icon_template: 'mdi:screwdriver'
    vacuum_do_not_disturb:
      friendly_name: Do Not Disturb
      value_template: '{{ states.vacuum.dalek.attributes.do_not_disturb }}'
      icon_template: >
        {% set val =  states.vacuum.dalek.attributes.do_not_disturb  %}
        {% if val == 'on' %}
          mdi:do-not-disturb
        {% else %}
          mdi:do-not-disturb-off
        {% endif %}
    vacuum_operation:
      value_template: 'Operation'
    vacuum_accessories:
      value_template: 'Maintenance'

- platform: template
  sensors:
    next_run_zone_1:
      friendly_name: 'Next Run'
      value_template: >-
        {% if states('input_select.zone_1_schedule') != 'Zone Off' %}
          {{ (as_timestamp(states.input_datetime.zone_1_next_run_time.state)) | timestamp_custom("%a %d %h at %H:%M") }}
        {% else %}
          None
        {% endif %}
    next_run_zone_2:
      friendly_name: 'Next Run'
      value_template: >-
        {% if states('input_select.zone_2_schedule') != 'Zone Off' %}
          {{ (as_timestamp(states.input_datetime.zone_2_next_run_time.state)) | timestamp_custom("%a %d %h at %H:%M") }}
        {% else %}
          None
        {% endif %}
    next_run_zone_3:
      friendly_name: 'Next Run'
      value_template: >-
        {% if states('input_select.zone_3_schedule') != 'Zone Off' %}
          {{ (as_timestamp(states.input_datetime.zone_3_next_run_time.state)) | timestamp_custom("%a %d %h at %H:%M") }}
        {% else %}
          None
        {% endif %}
    next_run_zone_4:
      friendly_name: 'Next Run'
      value_template: >-
        {% if states('input_select.zone_4_schedule') != 'Zone Off' %}
          {{ (as_timestamp(states.input_datetime.zone_4_next_run_time.state)) | timestamp_custom("%a %d %h at %H:%M") }}
        {% else %}
          None
        {% endif %}

#- platform: zoneminder

- platform: afvalbeheer
  wastecollector: RecycleApp
  resources:
    - restafval
    - papier
    - pmd
    - groenafval
  postcode: !secret ophaalkalender_postcode
  streetname: !secret ophaalkalender_streetname
  upcomingsensor: 1
  builtinicons: 1
  
- platform: mqtt
  name: "Water Pump Flow Rate"
  unit_of_measurement: "L/h"
  state_topic: "smarthouse/water/flow-meter/1"
  value_template: "{{ value_json.mL_per_min * 0.06 }}"
  icon: mdi:water-pump
  
- platform: integration
  source: sensor.water_pump_flow_rate
  name: "Water Pump Usage"
  unit_time: "h"
  method: "left"

- platform: template
  sensors:
    waterpump_cost:
      friendly_name: 'Waterpump Cost Yearly'
      #value_template: "{{ (states('sensor.energy_t31_light_and_power_total')|float(0) * states('input_number.t31_energy_cost')|float(0) + states('input_number.t31_daily_cost')|float(0) )|round(2) }}"
      value_template: "{{ (states('sensor.waterpump_current_usage_yearly_normaal') | float(0) * states('input_number.energy_cost') | float(0) / 100) | round (2) }}"
      unit_of_measurement: "€"
    energy_cost_yearly:
      friendly_name: 'Energy Cost Yearly'
      #value_template: "{{ (states('sensor.energy_t31_light_and_power_total')|float(0) * states('input_number.t31_energy_cost')|float(0) + states('input_number.t31_daily_cost')|float(0) )|round(2) }}"
      value_template: "{{ (states('sensor.total_current_yearly') | float(0) * states('input_number.energy_cost') | float(0) / 100) | round (2) }}"
      unit_of_measurement: "€"

- platform: template

  sensors:
    total_current_daily:
      friendly_name: "Total Current Daily"
      value_template: "{{ (states('sensor.droogkast_current_usage_daily_normaal') | float(0) + states('sensor.wasmachine_current_usage_daily_normaal') | float(0) + states('sensor.boiler_keuken_current_usage_daily_normaal') | float(0) + states('sensor.koelkast_vriezer_garage_current_usage_daily_normaal') | float(0) + states('sensor.waterpump_current_usage_daily_normaal') | float(0) + states('sensor.verlichting_gang_eerste_verdiep_current_usage_daily_normaal') | float(0) + states('sensor.verlichting_voordeur_current_usage_daily_normaal') | float(0) + states('sensor.verlichting_inkom_current_usage_daily_normaal') | float(0) + states('sensor.koelkast_vriezer_berging_current_usage_daily_normaal') | float(0) + states('sensor.koelkast_keuken_current_usage_daily_normaal') | float(0) + states('sensor.vriezer_garage_current_usage_daily_normaal') | float(0) ) | round(2) }}"
      unit_of_measurement: "kwh"
    total_current_yearly:
      friendly_name: "Total Current yearly"
      value_template: "{{ (states('sensor.droogkast_current_usage_yearly_normaal') | float(0) + states('sensor.wasmachine_current_usage_yearly_normaal') | float(0) + states('sensor.boiler_keuken_current_usage_yearly_normaal') | float(0) + states('sensor.koelkast_vriezer_garage_current_usage_yearly_normaal') | float(0) + states('sensor.waterpump_current_usage_yearly_normaal') | float(0) + states('sensor.verlichting_gang_eerste_verdiep_current_usage_yearly_normaal') | float(0) + states('sensor.verlichting_voordeur_current_usage_yearly_normaal') | float(0) + states('sensor.verlichting_inkom_current_usage_yearly_normaal') | float(0) + states('sensor.koelkast_vriezer_berging_current_usage_yearly_normaal') | float(0) + states('sensor.koelkast_keuken_current_usage_yearly_normaal') | float(0) + states('sensor.garage_vriezer_current_usage_yearly_normaal') | float(0) ) | round(2) }}"
      unit_of_measurement: "kwh"  

- platform: template
  sensors:
    refrigeration_current_daily:
      value_template: "{{ (states('sensor.koelkast_vriezer_garage_current_usage_daily_normaal') | float(0) + states('sensor.koelkast_vriezer_berging_current_usage_daily_normaal') | float(0) + states('sensor.koelkast_keuken_current_usage_daily_normaal') | float(0) + states('sensor.vriezer_garage_current_usage_daily_normaal') | float(0) ) | round(2) }}"
      unit_of_measurement: "kwh"
    refrigeration_current_weekly:
      value_template: "{{ (states('sensor.koelkast_vriezer_garage_current_usage_weekly_normaal') | float(0) + states('sensor.koelkast_vriezer_berging_current_usage_weekly_normaal') | float(0) + states('sensor.koelkast_keuken_current_usage_weekly_normaal') | float(0) + states('sensor.vriezer_garage_current_usage_weekly_normaal') | float(0) ) | round(2) }}"
      unit_of_measurement: "kwh"
    refrigeration_current_monthly:
      value_template: "{{ (states('sensor.koelkast_vriezer_garage_current_usage_monthly_normaal') | float(0) + states('sensor.koelkast_vriezer_berging_current_usage_monthly_normaal') | float(0) + states('sensor.koelkast_keuken_current_usage_monthly_normaal') | float(0) + states('sensor.vriezer_garage_current_usage_monthly_normaal') | float(0) ) | round(2) }}"
      unit_of_measurement: "kwh"
    refrigeration_current_yearly:
      value_template: "{{ (states('sensor.koelkast_vriezer_garage_current_usage_yearly_normaal') | float(0) + states('sensor.koelkast_vriezer_berging_current_usage_yearly_normaal') | float(0) + states('sensor.koelkast_keuken_current_usage_yearly_normaal') | float(0) + states('sensor.vriezer_garage_current_usage_yearly_normaal') | float(0) ) | round(2) }}"
      unit_of_measurement: "kwh"

- platform: template
  sensors:
    wash_dry_current_daily:
      value_template: "{{ (states('sensor.wasmachine_current_usage_daily_normaal') | float(0) + states('sensor.droogkast_current_usage_daily_normaal') | float(0) ) | round(2) }}"
      unit_of_measurement: "kwh"
    wash_dry_current_weekly:
      value_template: "{{ (states('sensor.wasmachine_current_usage_weekly_normaal') | float(0) + states('sensor.droogkast_current_usage_weekly_normaal') | float(0) ) | round(2) }}"
      unit_of_measurement: "kwh"
    wash_dry_current_monthly:
      value_template: "{{ (states('sensor.wasmachine_current_usage_monthly_normaal') | float(0) + states('sensor.droogkast_current_usage_monthly_normaal') | float(0) ) | round(2) }}"
      unit_of_measurement: "kwh"
    wash_dry_current_yearly:
      value_template: "{{ (states('sensor.wasmachine_current_usage_yearly_normaal') | float(0) + states('sensor.droogkast_current_usage_yearly_normaal') | float(0) ) | round(2) }}"
      unit_of_measurement: "kwh"

- platform: template
  sensors:
    computer_current_daily:
      value_template: "{{ (states('sensor.computer_current_usage_daily_normaal') | float(0) ) | round(2) }}"
      unit_of_measurement: "kwh"
    computer_current_weekly:
      value_template: "{{ (states('sensor.computer_current_usage_weekly_normaal') | float(0) ) | round(2) }}"
      unit_of_measurement: "kwh"
    computer_current_monthly:
      value_template: "{{ (states('sensor.computer_current_usage_monthly_normaal') | float(0) ) | round(2) }}"
      unit_of_measurement: "kwh"
    computer_current_yearly:
      value_template: "{{ (states('sensor.computer_current_usage_yearly_normaal') | float(0) ) | round(2) }}"
      unit_of_measurement: "kwh"

- platform: template
  sensors:
    lights_current_daily:
      value_template: "{{ (states('sensor.verlichting_gang_eerste_verdiep_current_usage_daily_normaal') | float(0) + states('sensor.verlichting_voordeur_current_usage_daily_normaal') | float(0) + states('sensor.verlichting_inkom_current_usage_daily_normaal') | float(0) ) | round(2) }}"
      unit_of_measurement: "kwh"
    lights_current_weekly:
      value_template: "{{ (states('sensor.verlichting_gang_eerste_verdiep_current_usage_weekly_normaal') | float(0) + states('sensor.verlichting_voordeur_current_usage_weekly_normaal') | float(0) + states('sensor.verlichting_inkom_current_usage_weekly_normaal') | float(0) ) | round(2) }}"
      unit_of_measurement: "kwh"
    lights_current_monthly:
      value_template: "{{ (states('sensor.verlichting_gang_eerste_verdiep_current_usage_monthly_normaal') | float(0) + states('sensor.verlichting_voordeur_current_usage_monthly_normaal') | float(0) + states('sensor.verlichting_inkom_current_usage_monthly_normaal') | float(0) ) | round(2) }}"
      unit_of_measurement: "kwh"
    lights_current_yearly:
      value_template: "{{ (states('sensor.verlichting_gang_eerste_verdiep_current_usage_yearly_normaal') | float(0) + states('sensor.verlichting_voordeur_current_usage_yearly_normaal') | float(0) + states('sensor.verlichting_inkom_current_usage_yearly_normaal') | float(0) ) | round(2) }}"
      unit_of_measurement: "kwh"

- platform: template
  sensors:
    current_consumption:
      value_template: >
        {{
          (states('sensor.waterpomp') | float(0) +
          states('sensor.verlichting_gang_eerste_verdiep_current_consumption') | float(0) +
          states('sensor.verlichting_inkom_power') | float(0) +
          states('sensor.verlichting_voordeur_power') | float(0) +
          states('sensor.koelkast_vriezer_berging') | float(0) +
          states('sensor.koelkast_vriezer_garage') | float(0) +
          states('sensor.koelkast_keuken') | float(0) +
          states('sensor.vriezer_garage') | float(0) +
          states('sensor.boiler_keuken') | float(0) +
          states('sensor.wasmachine') | float(0) +
          states('sensor.droogkast') | float(0) +
          states('sensor.computer') | float(0))
        }}
      unit_of_measurement: "w"

- platform: mqtt
  name: PVE CPU Usage
  state_topic: "pve/cpu_usage"
  unit_of_measurement: "%"
  icon: mdi:memory
- platform: mqtt
  name: PVE RAM Usage
  state_topic: "pve/ram_usage"
  unit_of_measurement: "%"
  icon: mdi:memory
- platform: mqtt
  name: PVE SWAP Usage
  state_topic: "pve/swap_usage"
  unit_of_measurement: "%"
  icon: mdi:memory
- platform: mqtt
  name: PVE CPU Temperature
  state_topic: "pve/cpu_temp"
  unit_of_measurement: "°C"
  device_class: "temperature"
  icon: mdi:thermometer
- platform: mqtt
  name: PVE SYS Temperature
  state_topic: "pve/sys_temp"
  unit_of_measurement: "°C"
  device_class: "temperature"
  icon: mdi:thermometer
- platform: mqtt
  name: PVE Disk NVME0 Temperature
  state_topic: "pve/disk/nvme0_temp"
  unit_of_measurement: "°C"
  device_class: "temperature"
  icon: mdi:thermometer
- platform: mqtt
  name: PVE Disk SDA Temperature
  state_topic: "pve/disk/sda_temp"
  unit_of_measurement: "°C"
  device_class: "temperature"
  icon: mdi:thermometer
- platform: mqtt
  name: PVE Disk SDB Temperature
  state_topic: "pve/disk/sdb_temp"
  unit_of_measurement: "°C"
  device_class: "temperature"
  icon: mdi:thermometer
- platform: mqtt
  name: PVE Disk SDC Temperature
  state_topic: "pve/disk/sdc_temp"
  unit_of_measurement: "°C"
  device_class: "temperature"
  icon: mdi:thermometer
- platform: mqtt
  name: PVE Disk SDD Temperature
  state_topic: "pve/disk/sdd_temp"
  unit_of_measurement: "°C"
  device_class: "temperature"
  icon: mdi:thermometer

- platform: template
  sensors:
    house_mode:
      friendly_name: House Mode
      value_template: >-
        {% if is_state('input_boolean.kids_home_alone', 'on') %}
          kids home alone
        {% elif is_state('binary_sensor.guest_mode', 'on') %}
          guest
        {% elif is_state('binary_sensor.no_one_home', 'off') %}
          home
        {% elif is_state('input_boolean.vacation_mode', 'on') %}
          vacation
        {% else %}
          away
        {% endif %}
      icon_template: >-
        {% if is_state('input_boolean.kids_home_alone', 'on') %}
          mdi:home-circle-outline
        {% elif is_state('binary_sensor.guest_mode', 'on') %}
          mdi:alpha-g
        {% elif is_state('binary_sensor.no_one_home', 'off') %}
          mdi:home
        {% elif is_state('input_boolean.vacation_mode', 'on') %}
          mdi:beach
        {% else %}
          mdi:home-outline
        {% endif %}
    oprit_last_motion:
      friendly_name: Oprit Last Motion
      value_template: >-
        {{ (as_timestamp(states.input_datetime.oprit_last_motion.state)) | timestamp_custom('%a %d %h at %H:%M') }}
    oprit_last_motion_event:
      friendly_name: Oprit Last Motion Event
      value_template: >-
        {{ "%02d" % (states('input_number.oprit_last_motion_event') |int (0) ) }}
    oprit_last_cctv_motion:
      friendly_name: Oprit Last CCTV Motion
      value_template: >-
        {{ (as_timestamp(states.input_datetime.oprit_last_cctv_motion.state)) | timestamp_custom('%a %d %h at %H:%M') }}
    oprit_last_cctv_motion_event:
      friendly_name: Oprit Last CCTV Motion Event
      value_template: >-
        {{ "%02d" % (states('input_number.oprit_last_cctv_motion_event') |int (0) ) }}

- platform: template
  sensors:
    operatingstate:
      value_template: "{{ state_attr('climate.huis', 'hvac_action') }}"
      attribute_templates:
          device_id: "{{ state_attr('binary_sensor.01_223036_schema', 'schema').system.heating_control }}"
    
    fc_heat_demand:
      friendly_name: "Boiler Demand"
      unit_of_measurement: "%"
      value_template: >-
        {{ state_attr('climate.huis', 'relay_demands').FC * 100 }}
      attribute_templates:
          device_id: "{{ state_attr('binary_sensor.01_223036_schema', 'schema').system.heating_control }}"

    fc_relay_demand:
      friendly_name: "heating_control (relay_demand)"
      unit_of_measurement: "%"
      value_template: >-
        {{ state_attr('climate.huis', 'relay_demands').FC * 100 }}
      attribute_templates:
        device_id: "{{ state_attr('binary_sensor.01_223036_schema', 'schema').system.heating_control }}"

- platform: history_stats
  name: Verwarmen Vandaag
  entity_id: sensor.operatingstate
  state: 'heating'
  type: time
  start: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
  end: '{{ now() }}'

- platform: history_stats
  name: Verwarmen Gisteren
  entity_id: sensor.operatingstate
  state: 'heating'
  type: time
  end: '{{ now().replace(hour=0).replace(minute=0).replace(second=0) }}'
  duration:
    hours: 24

- platform: history_stats
  name: Verwarmen 2 Dagen Geleden
  entity_id: sensor.operatingstate
  state: 'heating'
  type: time
  end: '{{ as_timestamp( now().replace(hour=0).replace(minute=0).replace(second=0) ) - 86400 }}'
  duration:
    hours: 24

- platform: history_stats
  name: Verwarmen Voorbij Week
  entity_id: sensor.operatingstate
  state: 'heating'
  type: time
  end: '{{ now().replace(hour=0, minute=0, second=0) }}'
  duration:
    days: 7

- platform: template
  sensors:
    ibbq_probe_1_grill_alert_temp:
      value_template: >-
        {% if (states('sensor.ibbq_temperature_probe_1') |int (0) ) < (states('input_number.grill_alert_low') |int (0) ) or (states('sensor.ibbq_temperature_probe_1') |int (0) )  > (states('input_number.grill_alert_high') |int (0) ) %}
          Alert
        {% else %}
          Normal
        {% endif %}
      friendly_name: Grill (Probe 1) WTemp Alert 
      icon_template: >-
        {% if (states('sensor.ibbq_temperature_probe_1') |int (0) ) < (states('input_number.grill_alert_low') |int (0) ) or (states('sensor.ibbq_temperature_probe_1') |int (0) )  > (states('input_number.grill_alert_high') |int (0) ) %}
          mdi:alert-circle
        {% else %}
          mdi:alert-circle-check
        {% endif %}
      
    ibbq_probe_2_target_alert_temp:
      value_template: >-
        {% if (states('sensor.ibbq_temperature_probe_2') |int (0) ) >= (states('input_number.grill_probe_2_target') |int (0) ) %}
          Alert
        {% else %}
          Normal
        {% endif %}
      friendly_name: Probe 2 Target Alert
      icon_template: >-
        {% if (states('sensor.ibbq_temperature_probe_2') |int (0) ) >= (states('input_number.grill_probe_2_target') |int (0) ) %}
          mdi:alert-circle
        {% else %}
          mdi:alert-circle-check
        {% endif %}
      
    ibbq_probe_3_target_alert_temp:
      value_template: >-
        {% if (states('sensor.ibbq_temperature_probe_3') |int (0) ) >= (states('input_number.grill_probe_3_target') |int (0) ) %}
          Alert
        {% else %}
          Normal
        {% endif %}
      friendly_name: Probe 3 Target Alert
      icon_template: >-
        {% if (states('sensor.ibbq_temperature_probe_3') |int (0) ) >= (states('input_number.grill_probe_3_target') |int (0) ) %}
          mdi:alert-circle
        {% else %}
          mdi:alert-circle-check
        {% endif %}
      
    ibbq_probe_4_target_alert_temp:
      value_template: >-
        {% if (states('sensor.ibbq_temperature_probe_4') |int (0) ) >= (states('input_number.grill_probe_4_target') |int (0) ) %}
          Alert
        {% else %}
          Normal
        {% endif %}
      friendly_name: Probe 4 Target Alert
      icon_template: >-
        {% if (states('sensor.ibbq_temperature_probe_4') |int (0) ) >= (states('input_number.grill_probe_4_target') |int (0) ) %}
          mdi:alert-circle
        {% else %}
          mdi:alert-circle-check
        {% endif %}

- platform: command_line
  name: Evohome Actuator State
  command: 'grep "|| OTB:040239 | CTL:223036 | RP | actuator_state   |      ||" /config/home-assistant.log | tail -n 1 | cut -d "|" -f 9| cut -d "," -f 12,13'
  scan_interval: 5